<!DOCTYPE html>
{% load static %}
<html lang="en">

<head>

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>E-DocPh</title>
	<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=no">
	<meta name="viewport" content="initial-scale=1.0, width=device-width">
	
	<link rel="icon" href="{% static 'stylesheet/images/favicon.ico' %}" type="image/x-icon">
	<link rel="shortcut icon" href="{% static '/img/untitled3.png' %}" type="image/x-icon">

	<!-- CSS Style -->

	<link rel="stylesheet" type="text/css" href="{% static 'css/checkout.css' %}">

	<link rel="stylesheet" type="text/css" href="{% static 'stylesheet/bootstrap.min.css' %}">
	<link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
		integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous" />
	<link rel="stylesheet" type="text/css" href="{% static 'stylesheet/revslider.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'stylesheet/jquery.bxslider.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'stylesheet/style.css' %}" media="all">
	<link rel="stylesheet" type="text/css" href="{% static 'stylesheet/owl.carousel.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'stylesheet/owl.theme.css}">
	<link rel="stylesheet" type="text/css" href="{% static 'stylesheet/flexslider.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'stylesheet/jquery.mobile-menu.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'stylesheet/responsive.css' %}">
	<link href="https://fonts.googleapis.com/css?family=Merriweather:300,300i,400,400i,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Oswald:300,400,500,600,700" rel="stylesheet">
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:700,600,800,400' rel='stylesheet' type='text/css'>
	<link href="https://fonts.googleapis.com/css?family=Rubik:400,400i,500,500i,700,700i,900" rel="stylesheet">

	<!-- BEGIN GOOGLE ANALYTICS CODEs -->

	<script type="text/javascript">
		var user = '{{request.user}}'

		function getToken(name) {
			var cookieValue = null;
			if (document.cookie && document.cookie !== '') {
				var cookies = document.cookie.split(';');
				for (var i = 0; i < cookies.length; i++) {
					var cookie = cookies[i].trim();
					// Does this cookie string begin with the name we want?
					if (cookie.substring(0, name.length + 1) === (name + '=')) {
						cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
						break;
					}
				}
			}
			return cookieValue;
		}
		var csrftoken = getToken('csrftoken')

		function getCookie(name) {
			// Split cookie string and get all individual name=value pairs in an array
			var cookieArr = document.cookie.split(";");

			// Loop through the array elements
			for (var i = 0; i < cookieArr.length; i++) {
				var cookiePair = cookieArr[i].split("=");

				/* Removing whitespace at the beginning of the cookie name
				and compare it with the given string */
				if (name == cookiePair[0].trim()) {
					// Decode the cookie value and return
					return decodeURIComponent(cookiePair[1]);
				}
			}

			// Return null if not found
			return null;
		}
		var cart = JSON.parse(getCookie('cart'))

		if (cart == undefined) {
			cart = {}
			console.log('Cart Created!', cart)
			document.cookie = 'cart=' + JSON.stringify(cart) + ";domain=;path=/"
		}
		console.log('Cart:', cart)

	</script>


</head>

<body>
	<div id="page">

		<!-- Header -->
		<header>

			<div id="header">
				<div class="container">
					<div class="header-container row">
						<div class="logo">
							<a href="{% url 'store' %}" title="index">
								<div>
									<img src="{% static '/img/untitled3.png' %}" alt="logo">

								</div>
							</a>
						</div>
						<div class="fl-nav-menu">
							<nav>
								<div class="mm-toggle-wrap">
									<div class="mm-toggle"><i class="icon-align-justify"></i><span
											class="mm-label">Menu</span> </div>
								</div>
								<div class="nav-inner">
									<!-- BEGIN NAV -->
									<ul id="nav" class="hidden-xs">
										<li> <a style="color:rgb(5, 5, 5); font-family: sans-serif; font-weight: bolder; "
												class="level-top"
												href="{% url 'store' %}"><span><strong>HOME</em></strong></span></a>
										</li>

									</ul>
								</div>
							</nav>
						</div>
						<div class="fl-header-right">

							<div class="fl-links">
								<div class="no-js"> <a title="Menu" class="clicker"></a>
									<div>
										<img style="width:80px; height: 80px; padding: 10%;"
											src="{% static 'img/menu.png' %}">
									</div>
									<div class="fl-nav-links">




										<ul class="links">




											<a href="{% url 'logoutu' %}" title="Logout"><span>Logout</span></a>

										</ul>
									</div>
								</div>
							</div>
							<div class="fl-cart-contain">
								<div class="mini-cart">
								
									<a href="{% url 'cart' %}"><span> {{order.get_cart_items}} </span>

										<div>
											<img style="width:80px; height: 80px;"
												src="{% static 'img/download.png' %}">
										</div>
									</a>
									<!-- </div> -->
								</div>
							</div>
							<div class="collapse navbar-collapse">
								<form class="navbar-form" role="search">
									<div class="input-group">
										<input type="text" class="form-control" placeholder="Search">
										<span class="input-group-btn">
											<button type="submit" class="search-btn"> <span
													class="glyphicon glyphicon-search"> <span
														class="sr-only">Search</span> </span> </button>
										</span>
									</div>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
		</header>
		<!-- Header End -->

		<div class="page-heading">
			<div class="breadcrumbs">
				<div class="container">
					<div class="row">
						<div class="col-xs-12">
							<ul>
								<li class="home"> <a href="{% url 'store' %}" title="Go to Home Page">Home</a>
									<span>&rsaquo;
									</span>
								</li>
								<li class="category1601"> <strong>shop</strong> </li>
							</ul>
						</div>
						<!--col-xs-12-->
					</div>
					<!--row-->
				</div>
			
			</div>
			<div class="page-title">
				<h2>Store</h2>
			</div>
		</div>
		
		<section class="main-container col2-left-layout bounceInUp animated">
		
			<div class="container">
				<div class="row">
					<!-- <div class="col-main col-md-9 col-md-push-3 product-grid col-sm-8 col-sm-push-4"> -->
					<div class="pro-coloumn">

						<article>


							<div class="category-products">
								<ul class="products-grid">

									<div class="row">
										<div class="col-lg-6">
											<div class="box-element" id="form-wrapper">
												<form id="form">
													{% csrf_token %}
													<div id="user-info">
														<div class="form-field">
															<input required class="form-control" type="text" name="name"
																placeholder="Name..">
														</div>
														<div class="form-field">
															<input required class="form-control" type="email"
																name="email" placeholder="Email..">
														</div>
													</div>

													<div id="shipping-info">
														<hr>
														<p>Shipping Information:</p>
														<hr>
														<div class="form-field">
															<input class="form-control" type="text" name="address"
																placeholder="Address..">
														</div>
														<div class="form-field">
															<input class="form-control" type="text" name="city"
																placeholder="City..">
														</div>
														<div class="form-field">
															<input class="form-control" type="text" name="state"
																placeholder="State..">
														</div>
														<div class="form-field">
															<input class="form-control" type="text" name="zipcode"
																placeholder="Zip code..">
														</div>
														<div class="form-field">
															<input class="form-control" type="text" name="contact_no"
																placeholder="Contact no..">
														</div>
													</div>

													<hr>
													<input id="form-button" class="btn btn-success btn-block"
														type="submit" value="Continue">
												</form>
											</div>

											<br>
											<div class="box-element hidden" id="payment-info">
												<small>Paypal Options</small>
												<!-- <button id="make-payment">Make payment</button> -->
												<div id="paypal-button-container"></div>
											</div>

										</div>

										<div class="col-lg-6">
											<div class="box-element">
												<a class="btn btn-outline-dark" href="{% url 'cart' %}">&#x2190;
													Back to Cart</a>
												<hr>
												<h3>Order Summary</h3>
												<hr>
												{% for item in items %}
												<div class="cart-row">
													<div style="flex:2"><img class="row-image"
															src="{{item.product.imageURL}}"></div>
													<div style="flex:2">
														<p>{{item.product.name}}</p>
													</div>
													<div style="flex:1">
														<p>${{item.product.price|floatformat:2}}</p>
													</div>
													<div style="flex:1">
														<p>x{{item.quantity}}</p>
													</div>
												</div>
												{% endfor %}
												<h5>Items: {{order.get_cart_items}}</h5>
												<h5>Total: ${{order.get_cart_total|floatformat:2}}</h5>
											</div>
										</div>

										<script
											src="https://www.paypal.com/sdk/js?client-id=AXKMOvSARJFQ3q0WFYhjTSNoK6tL9LNXZLiukMEEJKQlWTRV5Xqe1fSVFkOz_kFJ7VffW4N0By7FRfZd&currency=MYR&disable-funding=credit"></script>

										<script>
											var total = '{{order.get_cart_total}}'
											// Render the PayPal button into #paypal-button-container
											paypal.Buttons({

												style: {
													color: 'blue',
													shape: 'rect',
												},

												// Set up the transaction
												createOrder: function (data, actions) {
													return actions.order.create({
														purchase_units: [{
															amount: {
																value: parseFloat(total).toFixed(2)
															}
														}]
													});
												},

												// Finalize the transaction
												onApprove: function (data, actions) {
													return actions.order.capture().then(function (details) {
														// Show a success message to the buyer
														submitFormData()
													});
												}

											}).render('#paypal-button-container');
										</script>

										<script type="text/javascript">
											var shipping = '{{patient.shipping}}'
											var total = '{{order.get_cart_total}}'

											if (shipping == 'False') {
												document.getElementById('shipping-info').innerHTML = ''
											}

											if (user != 'AnonymousUser') {
												document.getElementById('user-info').innerHTML = ''
											}

											if (shipping == 'False' && user != 'AnonymousUser') {
												
												document.getElementById('form-wrapper').classList.add("hidden");
												
												document.getElementById('payment-info').classList.remove("hidden");
											}

											var form = document.getElementById('form')

											csrftoken = form.getElementsByTagName("input")[0].value
											console.log('newtoken:', form.getElementsByTagName("input")[0].value)


											form.addEventListener('submit', function (e) {
												e.preventDefault()
												console.log('Form Submitted...')
												document.getElementById('form-button').classList.add("hidden");
												document.getElementById('payment-info').classList.remove("hidden");
											})


											


											function submitFormData() {
												console.log('Payment button clicked')

												var userFormData = {
													'name': null,
													'email': null,
													'total': total,
												}

												var shippingInfo = {
													'address': null,
													'city': null,
													'state': null,
													'zipcode': null,
													'contact_no': null,
												}

												if (shipping != 'False') {
													shippingInfo.address = form.address.value
													shippingInfo.city = form.city.value
													shippingInfo.state = form.state.value
													shippingInfo.zipcode = form.zipcode.value
													shippingInfo.contact_no = form.contact_no.value
												}

												if (user == 'AnonymousUser') {
													userFormData.name = form.name.value
													userFormData.email = form.email.value
												}

												console.log('Shipping Info:', shippingInfo)
												console.log('User Info:', userFormData)

												var url = "/process_order/"
												fetch(url, {
													method: 'POST',
													headers: {
														'Content-Type': 'applicaiton/json',
														'X-CSRFToken': csrftoken,
													},
													body: JSON.stringify({ 'form': userFormData, 'shipping': shippingInfo }),



												});
												console.log('it came until here')
													.then((response) => response.json())
													.then((data) => {
														console.log('Success:', data);
														alert('Transaction completed');

														cart = {}
														document.cookie = 'cart=' + JSON.stringify(cart) + ";domain=;path=/"

														window.location.href = "{% url 'order_complete' %}"

													})
											}

										</script>

								</ul>
							</div>
							<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
								integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
								crossorigin="anonymous"></script>

							<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
								integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
								crossorigin="anonymous"></script>

							<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
								integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
								crossorigin="anonymous"></script>

							<script type="text/javascript" src="{% static 'js/cart.js' %}"></script>


						</article>
					</div>
	
				</div>
			
			</div>
		
		</section>


		<div class="container">
			<div class="row our-features-box">

			</div>
		</div>

	
		<footer>
	
			<div class="footer-top">
				<div class="container">
					<div class="row">
						<div class="col-xs-12 col-sm-4">
						</div>
						<div class="col-sm-4 col-xs-12 coppyright"> © 2021 Mazbah. All Rights Reserved. </div>

					</div>
				</div>
			</div>
	
		</footer>



	</div>

	<script src="{% static 'js1/js/jquery.min.js' %}"></script>
	<script src="{% static 'js1/js/bootstrap.min.js' %}"></script>
	<script src="{% static 'js1/js/common.js' %}"></script>
	<script src="{% static 'js1/js/owl.carousel.min.js' %}"></script>
	<script src="{% static 'js1/js/jquery.bxslider.min.js' %}"></script>
	<script src="{% static 'js1/js/jquery.flexslider.js' %}"></script>
	<script src="{% static 'js1/js/jquery.mobile-menu.min.js' %}"></script>
	<script src="{% static 'js/jquery.ez-plus.js' %}"></script>



</body>

</html>